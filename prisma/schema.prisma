generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  whopUserId String    @id @map("whop_user_id") @db.VarChar(255)
  name       String    @db.VarChar(255)
  role       UserRole  @default(MEMBER)
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  checkins   Checkin[]

  @@map("users")
}

model Checkin {
  id          String      @id @default(cuid())
  whopUserId  String      @map("whop_user_id") @db.VarChar(255)
  type        CheckinType
  muscleGroup String?     @map("muscle_group") @db.VarChar(50)
  note        String?
  photoUrl    String?     @map("photo_url")
  sharedPhoto Boolean     @default(false) @map("shared_photo")
  sharedNote  Boolean     @default(false) @map("shared_note")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  user        User        @relation(fields: [whopUserId], references: [whopUserId], onDelete: Cascade)

  @@index([whopUserId, createdAt])
  @@index([type])
  @@index([createdAt])
  @@map("checkins")
}

model CommunityStat {
  id           String   @id @default(cuid())
  date         DateTime @unique @db.Date
  totalMembers Int      @map("total_members")
  activeToday  Int      @map("active_today")
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([date])
  @@map("community_stats")
}

enum UserRole {
  MEMBER
  COACH
}

enum CheckinType {
  WORKOUT
  REST
  REFLECTION
}
